<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title> 입장료 계산기 </title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
</head>

<body>
    <div class="container">
        <h1> 입장료 계산기 </h1>
        <div id="time" style="text-align: end; font-weight: bolder;"></div>

        <div class="row">
            <div class="col" style="border: 2px solid salmon;">
                <p>성　인<input type="text" value="" id="adultInput">명</p>
                <p>어린이<input type="text" value="" id="childInput">명</p>
            </div>
            <div class="col" style="border: 2px solid salmon;">
                <p>단체할인에 해당하십니까?</p>
                <input type="radio" name="group" value="yes"><span>예</span>
                <input type="radio" name="group" value="no" checked><span>아뇨</span>
                <button class="btn btn-outline-danger" onclick="calc()">확인</button>
            </div>
            <div class="col-2" id="output" style="border: 2px solid salmon;">
                <img src="../img/good.png" id="outputImg">
            </div>
        </div>

        <div class="row">
            <div class="col">
                <p>성　인 1인당<input type="text" value="20000" id="adultFee" readonly style="border:none">원</p>
                <p>어린이 1인당<input type="text" value="9900" id="childFee" readonly style="border:none">원</p>
                <p>단 체 할 인<span>5명 이상 20%</span></p>
            </div>
            <div class="col">
                <p>18시 이후 야간 할인</p>
                <p>성　인 1인당<input type="text" value="12000" id="adultNgtFee" readonly style="border:none">원</p>
                <p>어린이 1인당<input type="text" value="4500" id="childNgtFee" readonly style="border:none">원</p>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <p>입장인원</p>
                <p>총 <input type="number" value="80" id="totalCnt" style="border:none"> 명</p>
                <button class="btn btn-outline-danger" onclick="createRandomNumber()">추첨하기</button>
            </div>
            <div class="col">
                <p>당첨자</p>
                <div id="lotto" class="lotto-container"></div>
            </div>
        </div>

    </div>
    <script>
        //현재시간
        const time = document.querySelector('#time');
        setInterval(() => {
            const curTime = moment().format('YYYY/MM/DD HH:mm:ss');
            time.innerHTML = `<p> ${curTime} </p>`;
        }, 1000);

        //야간할인용
        const hourStr = moment().format('HH');
        let hour = Number(hourStr)

        //계산함수
        function calc() {
            //주간가격
            const adultFeeStr = document.querySelector('#adultFee');
            const childFeeStr = document.querySelector('#childFee');
            const adultFee = Number(adultFeeStr.value);
            const childFee = Number(childFeeStr.value);
            //야간가격
            const adultNgtFeeStr = document.querySelector('#adultNgtFee');
            const childNgtFeeStr = document.querySelector('#childNgtFee');
            const adultNgtFee = Number(adultNgtFeeStr.value);
            const childNgtFee = Number(childNgtFeeStr.value);
            //입력값
            const adultInput = document.querySelector('#adultInput');
            const childInput = document.querySelector('#childInput');
            const adultInputStr = adultInput.value;
            const childInputStr = childInput.value;
            const adultCnt = Number(adultInputStr);
            const childCnt = Number(childInputStr);

            //단체할인적용
            const radios = document.getElementsByName('group');
            const selected = Array.from(radios).find(elem => elem.checked);

            const output = document.querySelector('#output');
            const outputImg = document.querySelector('#outputImg');

            // 입력값 확인작업
            if (isNaN(adultCnt) || isNaN(childCnt)) {
                //output.innerHTML = `<p> 숫자만 입력하세요! </p>`;
                outputImg.src = '../img/bad.png';
                output.insertAdjacentHTML('beforeend', `<p> 숫자만 입력하세요! </p>`);
                return;
            }

            // 입장 단체인지 야간인지
            let totalFee = 0;
            if (selected.value == 'no') {
                if (hour >= 18) { //야간
                    totalFee = (12000 * adultCnt) + (4500 * childCnt);
                } else { //주간
                    totalFee = (adultFee * adultCnt) + (childFee * childCnt);
                }
            } else {
                totalFee = ((adultFee * adultCnt) + (childFee * childCnt)) * 0.8;
            }

            //let total = totalFee.replace(/\B(?=(\d{3})+(?!\d))/g, ",")
            outputImg.src = '../img/good.png';
            output.insertAdjacentHTML('beforeend', `<p> 총 ${totalFee} 원 </p>`);
        }

        //로또자동
        function createRandomNumber() {
            const totalCntTemp = document.querySelector('#totalCnt');
            const totalCntStr = totalCntTemp.value;
            const totalCnt = Number(totalCntStr);

            const randomNumber = [];
            while (randomNumber.length < 6) {
                const number = Math.floor(Math.random() * totalCnt) + 1;
                if (!randomNumber.includes(number)) {
                    randomNumber.push(number);
                }
            }
            const sortedNumbers = randomNumber.sort((a, b) => a - b);

            const lotto = document.querySelector('#lotto');
            lotto.innerHTML = '';
            sortedNumbers.forEach(num => {
                const p = document.createElement('div');
                p.className = 'lotto-number';
                p.textContent = num;
                lotto.appendChild(p);
            });
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>고객관리</title>
    <style>
        #page1 {
            display: block;
        }

        #page2 {
            display: none;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <!--고객목록화면 Start-->
    <div class="container" id="page1">
        <div class="mt-4 d-flex justify-content-center">
            <span class="fw-bold fs-3"> 고객 목록 </span>
        </div>
        <!--Card Start-->
        <div class="card mt-4">
            <!--Card Body Start-->
            <div class="card-body">
                <!--List Strart-->
                <ul class="list-group" id="list1"></ul>
                <!--List End-->
            </div>
            <!--Card Body End-->

            <!--Card Footer Start-->
            <div class="card-footer">
                <!--Page Start-->
                <nav class="d-flex justify-content-center">
                    <ul class="pagination">
                        <li class="page-item disabled">
                            <a class="page-link">이전</a>
                        </li>
                        <li class="page-item active" aria-current="page">
                            <a class="page-link" href="#">1</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">2</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">3</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">다음</a>
                        </li>
                    </ul>
                </nav>
                <!--Page End-->
                <!--Add Btn Strat-->
                <div class="d-flex justify-content-end mt-2 mb-2">
                    <button class="btn btn-success fw-bold" id="addButton">추가</button>
                </div>
                <!--Add Btn End-->
            </div>
            <!--Card Footer End-->

        </div>
        <!--Card End-->

    </div>
    <!--고객목록화면 End-->

    <!--고객추가화면 Start-->
    <div class="container" id="page2">
        <div class="card mt-4">
            <div class="card-header text-center">
                <span class="fs-4 fw-bold" id="page2Title">고객 추가</span>
            </div>
            <div class="card-body">
                <div class="row g-3 align-items-center">
                    <div class="col-auto">
                        <label for="input1" class="col-form-label">name</label>
                    </div>
                    <div class="col-auto">
                        <input type="text" id="input1" class="form-control">
                    </div>
                </div>
                <div class="row mt-1 g-3 align-items-center">
                    <div class="col-auto">
                        <label for="input2" class="col-form-label">mobile</label>
                    </div>
                    <div class="col-auto">
                        <input type="text" id="input2" class="form-control">
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <div class="row">
                    <div class="col-6">
                        <button class="btn btn-primary btn-sm fw-bold" id="saveButton"> 저장</button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-secondary btn-sm fw-bold" id="closeButton">닫기</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--고객추가화면 End-->

    <script>
        //페이지 태그를 넣어둘 변수
        let page1;
        let page2;
        //입력상자를 넣어둘 변수
        let input1;
        let input2;
        //리스트
        let list1;
        let page2Title;
        //데이터를 넣어둘 변수
        let persons = [];
        //추가, 수정을 구분할 수 있는 변수
        let mode;
        //선택된 아이템의 인덱스를 넣어둘 변수
        let selected = -1;

        //웹 문서가 보이기 전에 한번 실행됨
        window.addEventListener('DOMContentLoaded', async () => {
            //페이지 태그를 찾아서 변수에 넣어두기
            page1 = document.querySelector('#page1');
            page2 = document.querySelector('#page2');
            //버튼이 눌려졌을 때 동작할 함수 예약
            const addButton = document.querySelector('#addButton');
            addButton.addEventListener('click', showAddItem);
            const saveButton = document.querySelector('#saveButton');
            saveButton.addEventListener('click', saveItem);
            const closeButton = document.querySelector('#closeButton');
            closeButton.addEventListener('click', show1);
            //입력상자를 찾아서 변수 넣어주기
            input1 = document.querySelector('#input1');
            input2 = document.querySelector('#input2');
            //리스트를 찾아서 변수에 넣어두기
            list1 = document.querySelector('#list1');
            page2Title = document.querySelector('#page2Title');

            /////////////////////////////////////////////////////////////////////////////////////
            //리스트 요청
            requestList();
            /////////////////////////////////////////////////////////////////////////////////////
        });
        
        /////////////////////////////////////////////////////////////////////////////////////
        //리스트 요청하는거 따로 함수 만들어
        //axios 요청할 때 사용 -> 응답 받은건 response로 들어옴
        async function requestList() {
            try {
                const response = await axios({
                    method: 'get',
                    baseURL: 'http://localhost:7001',
                    url: '/person/list',
                    responseType: 'json'
                })
                // console.log(`response -> ${JSON.stringify(response)}`);
                console.log(`response -> ${JSON.stringify(response.data.data)}`);
                persons = response.data.data;
                addListItems();
            } catch (err) {
                console.error(`response 요청 중 에러 발생: ${err}`);
            }
        }
        /////////////////////////////////////////////////////////////////////////////////////

        //저장이 두개라서 모드 바꿔주는거
        //고객추가, 고객정보수정
        function saveItem() {
            if (mode == 'add') {
                addItem();
            } else if (mode == 'modify') {
                modifyItem();
            }
        }

        //고객추가화면
        function showAddItem() {
            page2Title.innerHTML = '고객추가';
            mode = 'add';
            show2();
        }

        /////////////////////////////////////////////////////////////////////////////////////
        //아래 addItem() 수정함
        //웹서버랑 연동
        function addListItems() {
            let index = 0; 
            for (let person of persons) { //persons==166라인 //태그를 for문을 사용해서 하나씩 
                list1.innerHTML += `<li class="list-group-item" id="item${index}">
                        <div class="row d-flex align-items-center">
                            <div class="col-1">
                                <img class="rounded-circle" src="../images/person1.png"
                                    style="width: 4em; height: 4em;">
                            </div>
                            <div class="col-4">
                                <p id="item${index}_name">${person.name}</p>
                            </div>
                            <div class="col-4">
                                <p id="item${index}_mobile">${person.mobile}</p>
                            </div>
                            <div class="col-3">
                                <button class="btn btn-primary btn-sm fw-bold" onclick="showModifyPage(${index})">수정</button>
                                <button class="btn btn-danger btn-sm fw-bold" onclick="deleteItem(${index})">삭제</button>
                            </div>
                        </div>
                    </li>`;
                index += 1;
            }
        }
        /////////////////////////////////////////////////////////////////////////////////////

        //고객추가화면에서 저장버튼 눌렸을때
        function addItem() {
            //사용자가 입력한 글자 가져오기
            const name = input1.value;
            const mobile = input2.value;
            //인덱스 확인
            const index = persons.length;
            //목록 추가
            list1.innerHTML += `<li class="list-group-item" id="item${index}">
                        <div class="row d-flex align-items-center">
                            <div class="col-1">
                                <img class="rounded-circle" src="../images/person1.png"
                                    style="width: 4em; height: 4em;">
                            </div>
                            <div class="col-4">
                                <p id="item${index}_name">${name}</p>
                            </div>
                            <div class="col-4">
                                <p id="item${index}_mobile">${mobile}</p>
                            </div>
                            <div class="col-3">
                                <button class="btn btn-primary btn-sm fw-bold" onclick="showModifyPage(${index})">수정</button>
                                <button class="btn btn-danger btn-sm fw-bold" onclick="deleteItem(${index})">삭제</button>
                            </div>
                        </div>
                    </li>`;
            //배열에 고객추가
            persons.push({
                name: name,
                mobile: mobile
            })
            //내용 초기화
            input1.value = '';
            input2.value = '';
            show1();
        }

        //사용자가입력한정보를가지고수정해주는
        function modifyItem() {
            const itemName = document.querySelector(`#item${selected}_name`);
            const itemMobile = document.querySelector(`#item${selected}_mobile`);
            const name = input1.value;
            const mobile = input2.value;
            itemName.innerHTML = name;
            itemMobile.innerHTML = mobile;
            persons[selected].name = name;
            persons[selected].mobile = mobile;
            show1();
        }

        //고객목록화면의 수정버튼 눌렸을때
        function showModifyPage(index) {
            //고객추가화면의 제목변경
            page2Title.innerHTML = '고객정보 수정';

            mode = 'modify';
            selected = index;
            const person = persons[index];
            input1.value = person.name;
            input2.value = person.mobile;
            show2();
        }

        //삭제하기
        function deleteItem(index) {
            const item = document.querySelector(`#item${index}`);
            item.remove(); //목록에서 삭제
            persons.splice(index, 1); //배열안의 요소 삭제하는 함수(인덱스 1개만)
        }

        //목록화면(1) | 추가화면(2)
        function show1() {
            page1.style.display = 'block';
            page2.style.display = 'none';
        }
        function show2() {
            page1.style.display = 'none';
            page2.style.display = 'block';
        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>